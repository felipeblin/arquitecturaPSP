(function ($, window) {
    $.fn.contextMenu = function (settings) {
        return this.each(function () {
            /*$(this).on("contextmenu", function (e) {
                if (e.ctrlKey) return;
                $(".dropdown-menu").hide();
                if ($(settings.menuSelector).find('a').length == 0 && $(settings.menuSelector).find('button').length == 0) {
                    return false;
                }
                var $menu = $(settings.menuSelector)
                    .data("invokedOn", $(e.target))
                    .show()
                    .css({
                        position: "absolute",
                        left: getMenuPosition(e.clientX, 'width', 'scrollLeft') - 100,
                        top: getMenuPosition(e.clientY, 'height', 'scrollTop') - 190
                    })
                    .off('click')
                    .on('click', 'a', function (e) {
                        $menu.hide();

                        var $invokedOn = $menu.data("invokedOn");
                        var $selectedMenu = $(e.target);

                        settings.menuSelected.call(this, $invokedOn, $selectedMenu);
                    });

                return false;
            });*/

            $(this).on("click", function (e) {
                // return native menu if pressing control
                console.log(e.target.tagName)
                if (e.target.tagName == 'A') {
                    return;
                }
                if (e.ctrlKey) return;
                $(".dropdown-menu").hide();

                if ($(settings.menuSelector).find('a').length == 0 && $(settings.menuSelector).find('button').length == 0) {
                    return false;
                }

                //open menu
                $('.popover').hide();
                var $menu = $(settings.menuSelector)
                    .data("invokedOn", $(e.target))
                    .show()
                    .css({
                        position: "absolute",
                        left: getMenuPosition(e.clientX, 'width', 'scrollLeft') - 100,
                        top: getMenuPosition(e.clientY, 'height', 'scrollTop') - 190
                    })
                    .off('click')
                    .on('click', 'a', function (e) {
                        $menu.hide();

                        var $invokedOn = $menu.data("invokedOn");
                        var $selectedMenu = $(e.target);

                        settings.menuSelected.call(this, $invokedOn, $selectedMenu);
                    });
                if ($menu.find('a').length == 1) {
                    $menu.find('a').get(0).click();
                }
                return false;
            });

            //make sure menu closes on any click
            $('body').click(function () {
                $(settings.menuSelector).hide();
            });
        });

        function getMenuPosition(mouse, direction, scrollDir) {
            var win = $(window)[direction](),
                scroll = $(window)[scrollDir](),
                menu = $(settings.menuSelector)[direction](),
                position = mouse + scroll;

            // opening menu would pass the side of the page
            if (mouse + menu > win && menu < mouse)
                position -= menu;

            return position;
        }

    };
})(jQuery, window);



(function ($, window) {
    $.fn.contextMenu2 = function (settings) {
        return this.each(function () {
            $(this).on("contextmenu", function (e) {
                if (e.ctrlKey) return;
                $(".dropdown-menu").hide();
                if ($(settings.menuSelector).find('a').length == 0 && $(settings.menuSelector).find('button').length == 0) {
                    return false;
                }
                var $menu = $(settings.menuSelector)
                    .data("invokedOn", $(e.target))
                    .show()
                    .css({
                        position: "absolute",
                        left: getMenuPosition(e.clientX, 'width', 'scrollLeft') - 50,
                        top: getMenuPosition(e.clientY, 'height', 'scrollTop') - 50
                    })
                    .off('click')
                    .on('click', 'a', function (e) {
                        $menu.hide();

                        var $invokedOn = $menu.data("invokedOn");
                        var $selectedMenu = $(e.target);

                        settings.menuSelected.call(this, $invokedOn, $selectedMenu);
                    });

                return false;
            });


            //make sure menu closes on any click
            $('body').click(function () {
                $(settings.menuSelector).hide();
            });
        });

        function getMenuPosition(mouse, direction, scrollDir) {
            var win = $(window)[direction](),
                scroll = $(window)[scrollDir](),
                menu = $(settings.menuSelector)[direction](),
                position = mouse + scroll;

            // opening menu would pass the side of the page
            if (mouse + menu > win && menu < mouse)
                position -= menu;

            return position;
        }

    };
})(jQuery, window);